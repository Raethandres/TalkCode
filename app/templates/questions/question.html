{% extends 'base/base.html' %}
{% set title = 'Question ' %}
{% from "macros/_macro.html" import render_field %}

{% block content %}

<script src="{{ url_for('static', filename='codemirror/mode/javascript/javascript.js') }}"/></script>
<script src="{{ url_for('static', filename='js/counter_letter.js') }}"/></script>

<div class="container">
  <br>
   <div class="col-md-8">
     <form method="POST">
         {% from "macros/_macro.html" import render_field %}
         <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
               {{ render_field(new_QuestionForm.tittle, class='form-litle', value=Question_data.title ) }}
               {{ render_field(new_QuestionForm.description, class='description-area' ) }}
      <ul class="tags">
         <li><a href="#" class="tag-question" style="text-decoration:none;">{{Tag.tag_one}}</a></li>
         <li><a href="#" class="tag-question" style="text-decoration:none;">{{Tag.tag_two}}</a></li>
         <li><a href="#" class="tag-question" style="text-decoration:none;">{{Tag.tag_three}}</a></li>
         <li><a href="#" class="tag-question upvote" style="text-decoration:none;">{{ Question_data.upvote}}</a></li>
         <li><a href="#" class="tag-question downvote" style="text-decoration:none;">{{ Question_data.downvote}}</a></li>
         <li><a href="#" class="tag-question user" style="text-decoration:none;">{{ User.username }}</a></li>
      </ul><br>
                      <script type="text/javascript">
                        $('.description-area').val({{Question_data.description | tojson}}).css('resize', 'none');

                        $(document).ready(function () {
                          var myCodeQuestion = $('.CodeQuestion')[0];
                          var myCodeMirror = CodeMirror.fromTextArea(myCodeQuestion,{
                            styleActiveLine: true,
                            lineNumbers:true,
                            theme: 'ttcn',
                            lineWrapping: true,
                            mode: 'javascript',
                            readOnly: true
                          });
                          myCodeMirror.getDoc().setValue({{Question_data.text_area | tojson}});
                          setTimeout(function() {
                            myCodeMirror.refresh();
                          },1);
                        });
                      </script>

      {{ render_field(new_QuestionForm.text_area, class='CodeQuestion') }}
      </form>

   </div>

   {% if is_authenticated %}
   <div class="col-md-8">
      <br>
      <center><h4 class="text-pre-answer">Responde</h4></center>
      <form class="" method="POST">
         {% from "macros/_macro.html" import render_field %}
         <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
         <div class="form-group">
            {{ render_field(answer_long.answer_long, class='answer-area' ) }}
            <p class="help-block">Escribe tu respuesta</p>
            <br>
         </div>
         <div class="area-text-question">
            {{ render_field(answer_long.text_area, class='TextArea') }}
         </div>
         <button type="submit" class="btn-counter_letter right  btn btn-raised btn-sm btn-success">Submit <p class="counter"></p> </button>
      </form>
   </div>
   {% else %}
   <br>
   {% endif %}
   {% if Answers %}
   {% for answer in Answers  %}
   <div class="col-md-8">
      <br>
      <h5><i class="icon-info text-success"></i>
         {{  answer.answer }} | <a href="/user/{{ answer.id_user }} "class="text-muted"> {{ answer.name_user }}</a>
      </h5>
      <div class="list-group-item">
         <div class="row-content">
            <a type="button" class="btn btn-success btn-xs">Upvote {{ answer.upvote}}</a>
            <a type="button" class="btn btn-danger  btn-xs">Downvote {{ answer.downvote}}</a>
            <p class="right"> {{ answer.create_date }} </p>
            <div class="prettyBlock">
               <div class="prettyPrint">
                  <?prettify?>
<pre class="prettyprint linenums">
{{ answer.answer_code }}
</pre>
               </div>
            </div>
            <br>
         </div>
      </div>
   </div>
   {% endfor %}
   {% else %}
   <center>
      <h5><i class="icon-info"></i> No hay Respuestas, responde tu!</h5>
   </center>
   {% endif %}
</div>



<script type="text/javascript">
  $(document).ready(function () {
    var myTextArea = $('.TextArea')[0];
    var myCodeMirror = CodeMirror.fromTextArea(myTextArea,{
      styleActiveLine: true,
      lineNumbers:true,
      theme: 'ambiance',
      lineWrapping: true,
      mode: 'javascript',
      viewportMargin: Infinity,
    });
    myCodeMirror.setSize(710, '20%');
    var button = $('.btn-counter_letter');
    var textCounter = $('.counter');
    var field = $('.answer-area');
    LetterCounter(1, 250, field, button, textCounter);

  });
</script>


{% endblock %}
